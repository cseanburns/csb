<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Logical Volume Management - Linux Systems Administration</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./linux-sysadmin.html"><strong>1.</strong> Linux Systems Administration</a></li><li><a href="./p1-system-basics.html"><strong>2.</strong> System Basics</a></li><li><ul class="section"><li><a href="./01-history-linux-unix.html"><strong>2.1.</strong> History of Unix and Linux</a></li><li><a href="./02-quick-ssh-connect.html"><strong>2.2.</strong> Connect to a Remote Server</a></li><li><a href="./03-filesystem-file-management.html"><strong>2.3.</strong> Linux Filesystems and File Management</a></li><li><a href="./04-file-attributes.html"><strong>2.4.</strong> File Attributes</a></li><li><a href="./05-text-processing-part-1.html"><strong>2.5.</strong> Text Processing, Part 1</a></li><li><a href="./06-text-processing-part-2.html"><strong>2.6.</strong> Text Processing, Part 2</a></li><li><a href="./07-text-editors.html"><strong>2.7.</strong> Text Editors</a></li><li><a href="./08-revisiting-paths.html"><strong>2.8.</strong> Revisiting Paths</a></li><li><a href="./09-bash-scripting.html"><strong>2.9.</strong> Bash Scripting</a></li><li><a href="./10-regular-expressions.html"><strong>2.10.</strong> Regular Expressions</a></li></ul></li><li><a href="./p2-managing-services-software.html"><strong>3.</strong> Managing Services and Software</a></li><li><ul class="section"><li><a href="./11-using-gcloud.html"><strong>3.1.</strong> Using gcloud for Virtual Machines</a></li><li><a href="./12-logical-volumes.html" class="active"><strong>3.2.</strong> Logical Volume Management</a></li><li><a href="./13-virtualbox-nat.html"><strong>3.3.</strong> Using NAT in VirtualBox</a></li><li><a href="./14-webconsole-nat.html"><strong>3.4.</strong> NAT Table in VirtualBox</a></li><li><a href="./15-managing-users-groups.html"><strong>3.5.</strong> Managing Users and Groups</a></li><li><a href="./16-systemd.html"><strong>3.6.</strong> systemd</a></li><li><a href="./17-backup-and-using-dnf.html"><strong>3.7.</strong> Backups and DNF</a></li></ul></li><li><a href="./p3-networking-security.html"><strong>4.</strong> Networking and Security</a></li><li><ul class="section"><li><a href="./18-tcip-networking.html"><strong>4.1.</strong> TCIP Networking</a></li><li><a href="./19-networking-dns-domains.html"><strong>4.2.</strong> DNS and Domain Names</a></li><li><a href="./20-security-chroot.html"><strong>4.3.</strong> Security and chroot</a></li><li><a href="./21-security-firewall.html"><strong>4.4.</strong> Security and Firewalls</a></li></ul></li><li><a href="./p4-lamp.html"><strong>5.</strong> Creating a LAMP Server</a></li><li><ul class="section"><li><a href="./22-httpd-apache.html"><strong>5.1.</strong> Apache2 Web Server</a></li><li><a href="./23-httpd-php.html"><strong>5.2.</strong> Apache2 and PHP</a></li><li><a href="./24-httpd-virtualhosts.html"><strong>5.3.</strong> Apache2 and Virtual Hosts</a></li><li><a href="./25-httpd-mysql.html"><strong>5.4.</strong> Apache2 and MySQL</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./12-logical-volumes.html#logical-volume-management" id="logical-volume-management"><h1>Logical Volume Management</h1></a>
<a class="header" href="./12-logical-volumes.html#background-reading-and-documentation" id="background-reading-and-documentation"><h2>Background Reading and Documentation</h2></a>
<p>Please read the following two articles before proceeding:</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-lvm-concepts-terminology-and-operations">An Introduction to LVM Concepts, Terminology, and Operations</a></li>
<li><a href="https://opensource.com/business/16/9/linux-users-guide-lvm">A Linux User's Guide to Logical Volume Management</a></li>
</ul>
<p>Additionally, you should review / skim some helpful <code>man</code> or <code>info</code> pages before proceeding:</p>
<ul>
<li><code>man filesytems</code></li>
<li><code>man ext4</code></li>
<li><code>man btrfs</code></li>
<li><code>man vgdisplay</code></li>
<li><code>man pvdisplay</code></li>
<li><code>man lvdisplay</code></li>
<li><code>man pvcreate</code></li>
<li><code>man lvcreate</code></li>
<li><code>man vgextend</code></li>
<li><code>man fdisk</code></li>
<li><code>man lsblk</code></li>
<li><code>man fstab</code></li>
<li><code>man parted</code></li>
<li><code>man mount</code></li>
<li><code>man cfdisk</code></li>
</ul>
<p>The second link above demonstrates some other logical volume commands that we are not using here. Give the <code>man</code> or <code>info</code> pages for those a read, too.</p>
<a class="header" href="./12-logical-volumes.html#our-motivation" id="our-motivation"><h2>Our motivation</h2></a>
<p>When we installed Fedora in VirtualBox, we told VirtualBox that our hard drive would be a 100 GB in size. However, when we partitioned our hard drive, we only partitioned around 67 GB of that space. In this lesson, we are going to create a new partition of the <strong>sda</strong> partition, and then expand our logical volume to include this partition. We'll allocate 15 GB of the remaining space to <strong>sda3</strong>.</p>
<p>Briefly:</p>
<ul>
<li>Physical volumes (the <em>pv</em> commands) are related to the physical devices.</li>
<li>Volume groups (the <em>vg</em> commands) organize the physical and logical volumes.</li>
<li>Logical volumes (the <em>lv</em> commands) are about partitions.</li>
</ul>
<a class="header" href="./12-logical-volumes.html#procedure" id="procedure"><h2>Procedure</h2></a>
<a class="header" href="./12-logical-volumes.html#administrative-commands" id="administrative-commands"><h3>Administrative commands</h3></a>
<p>We need to use the <code>sudo</code> command to run many of the commands below or login as <strong>root</strong> user. Either way, be careful about running commands with <code>sudo</code> or as root. Mistyping a command may harm your system beyond repair. If you do harm your system beyond repair, delete your clone in VirtualBox and reclone the original install. In the demonstration that follows, I will login as the <strong>root</strong> user.</p>
<p>If you would like to login as root, you can login as root at the intitial prompt after you system boots up; or, if you are already logged in as a regular user, you can type the <code>su root</code> command and then enter the root password that you set when you installed Fedora, or you can use the <code>sudo su</code> command if you are in the wheel group:</p>
<pre><code>su root
</code></pre>
<p>Or:</p>
<pre><code>sudo su
</code></pre>
<a class="header" href="./12-logical-volumes.html#gather-information" id="gather-information"><h3>Gather information</h3></a>
<p>First we need take a look at what we have before we start. Pay some attention to the details:</p>
<pre><code>lsblk
fdisk -l | less
</code></pre>
<a class="header" href="./12-logical-volumes.html#create-a-partition" id="create-a-partition"><h3>Create a Partition</h3></a>
<p>We can use a program called <code>parted</code> or a slightly more user friendly program called <code>cfdisk</code>. We'll use <code>cfdisk</code>:</p>
<pre><code>cfdisk
</code></pre>
<p>In <code>cfdisk</code>, complete the following steps:</p>
<ul>
<li>Arrow down to the <strong>Free space</strong> section, and press Enter on <strong>New</strong>.</li>
<li>Next to Partition size, backspace over value and then type <strong>15GB</strong></li>
<li>Set to <strong>primary</strong></li>
<li>Use right arrow key to select <strong>Type</strong></li>
<li>Arrow down to the <strong>8e Linux LVM</strong> selection and press enter</li>
<li>User right arrow key to select <strong>Write</strong>, and then type <strong>yes</strong> at the prompt to write the partition to the virtual disk</li>
</ul>
<a class="header" href="./12-logical-volumes.html#creating-a-physical-volume" id="creating-a-physical-volume"><h3>Creating a Physical Volume</h3></a>
<p>Next let's create a new physical volume to refer to our new partition. It's important to read the man pages for <em>pvdisplay</em> and <em>pvcreate</em> before you start so that you get a better idea of what you're doing, above and beyond what I'm detailing here or the links above describe. Here we'll use <code>pvdisplay</code> before and after we use <code>pvcreate</code> to note the differenc after we use the latter command:</p>
<pre><code>pvdisplay
pvcreate /dev/sda3
pvdisplay
</code></pre>
<a class="header" href="./12-logical-volumes.html#add-a-physical-volume-to-a-volume-group" id="add-a-physical-volume-to-a-volume-group"><h3>Add a Physical Volume to a Volume Group</h3></a>
<p>Now we add our new physical volume to an existing volume group, which was created when we installed Fedora. Usage note: <code>vgextend VG PV</code>. (See man page, of course :)</p>
<p>Below, the volume group name is <strong>fedora_fedora</strong> and the physical volume name is, per the last set of commands, <strong>/dev/sda3</strong>. By extending the volume group, we'll have extended its size to encompass the new partition:</p>
<pre><code>vgdisplay
vgextend fedora_fedora /dev/sda3
vgdisplay
</code></pre>
<a class="header" href="./12-logical-volumes.html#creating-a-logical-volume" id="creating-a-logical-volume"><h3>Creating a Logical Volume</h3></a>
<p>We create a logical volume to allow us to mount the partition and make it accessible to the other parts of the file system. Note: man pages!!!</p>
<pre><code>lvdisplay | less
lsblk
vgdisplay # note Free PE / Size space
lvcreate -L +15GiB --name projects fedora_fedora
lvdisplay
</code></pre>
<a class="header" href="./12-logical-volumes.html#creating-a-file-system-for-the-lv" id="creating-a-file-system-for-the-lv"><h3>Creating a File System for the LV</h3></a>
<p>Now we need to <strong>format the logical volume</strong>: read the man pages for the commands below, including <code>man fstab</code>.</p>
<pre><code>mkfs.ext4 /dev/fedora_fedora/projects
mkdir /projects
mount /dev/fedora_fedora/projects /projects
</code></pre>
<p>In <code>nano</code>, enter this in the <strong>/etc/fstab</strong> file:</p>
<pre><code>/dev/mapper/fedora_fedora-projects  /projects ext4   defaults    1 2
</code></pre>
<p>Per the instructions in that file, run the following command:</p>
<pre><code>systemctl daemon-reload
</code></pre>
<p>Now reboot the machine. When you reboot, your new partition should be recognized and mounted automatically.</p>
<pre><code>reboot now
</code></pre>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="./11-using-gcloud.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="./13-virtualbox-nat.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./11-using-gcloud.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./13-virtualbox-nat.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
