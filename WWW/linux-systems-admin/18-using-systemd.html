<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Using systemd - Linux Systems Administration</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Book on entry level Linux systems administration work.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="p1-linux-sysadmin.html"><strong>1.</strong> Linux Systems Administration</a></li><li><ul class="section"><li><a href="01-history-linux-unix.html"><strong>1.1.</strong> History of Unix and Linux</a></li><li><a href="02-what-is-linux.html"><strong>1.2.</strong> What is Linux?</a></li><li><a href="03-what-is-sysadmin.html"><strong>1.3.</strong> What is Systems Administration?</a></li></ul></li><li><a href="p2-using-gcloud.html"><strong>2.</strong> Using Google Cloud (gcloud)</a></li><li><ul class="section"><li><a href="05-using-gcloud-virtual-machines.html"><strong>2.1.</strong> Using gcloud for Virtual Machines</a></li></ul></li><li><a href="p3-the-command-line.html"><strong>3.</strong> Learning the Command Line</a></li><li><ul class="section"><li><a href="06-the-linux-filesystem.html"><strong>3.1.</strong> The Linux Filesystem</a></li><li><a href="07-files-and-directories.html"><strong>3.2.</strong> Files and Directories</a></li><li><a href="08-file-attributes.html"><strong>3.3.</strong> File Attributes</a></li><li><a href="09-text-processing-part-1.html"><strong>3.4.</strong> Text Processing: Part 1</a></li><li><a href="10-text-processing-part-2.html"><strong>3.5.</strong> Text Processing: Part 2</a></li><li><a href="11-text-editors.html"><strong>3.6.</strong> Text Editors</a></li><li><a href="12-revisiting-directory-paths.html"><strong>3.7.</strong> Revisiting Directory Paths</a></li><li><a href="13-bash-scripting.html"><strong>3.8.</strong> Bash Scripting</a></li><li><a href="14-regular-expressions.html"><strong>3.9.</strong> Regular Expressions</a></li></ul></li><li><a href="p4-managing-the-system.html"><strong>4.</strong> Managing the System</a></li><li><ul class="section"><li><a href="15-expanding-storage.html"><strong>4.1.</strong> Expanding Storage</a></li><li><a href="16-managing-users-groups.html"><strong>4.2.</strong> Managing Users and Groups</a></li><li><a href="17-managing-software.html"><strong>4.3.</strong> Managing Software</a></li><li><a href="18-using-systemd.html" class="active"><strong>4.4.</strong> Using systemd</a></li></ul></li><li><a href="p5-networking-security.html"><strong>5.</strong> Networking and Security</a></li><li><ul class="section"><li><a href="19-networking-tcpip.html"><strong>5.1.</strong> Networking and TCP/IP</a></li><li><a href="20-dns-domain-names.html"><strong>5.2.</strong> DNS and Domain Names</a></li><li><a href="21-local-security.html"><strong>5.3.</strong> Local Security</a></li><li><a href="22-firewall-backups.html"><strong>5.4.</strong> Firewalls and Backups</a></li></ul></li><li><a href="p6-creating-a-lamp-server.html"><strong>6.</strong> Creating a LAMP Server</a></li><li><ul class="section"><li><a href="23-installing-the-apache-web-server.html"><strong>6.1.</strong> Installing the Apache Web Server</a></li><li><a href="24-installing-configuring-php.html"><strong>6.2.</strong> Installing and Configuring PHP</a></li><li><a href="25-installing-configuring-mariadb.html"><strong>6.3.</strong> Installing and Configuring MariaDB</a></li></ul></li><li><a href="p7-conclusion.html"><strong>7.</strong> Conclusion</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="18-using-systemd.html#using-systemd" id="using-systemd"><h1>Using systemd</h1></a>
<a class="header" href="18-using-systemd.html#introduction" id="introduction"><h2>Introduction</h2></a>
<p>When computers boot up,
obviously some software manages that process.
On Linux and other Unix or Unix-like systems,
this is usually handled via an <strong>init</strong> system.
For example, macOS uses <a href="https://en.wikipedia.org/wiki/Launchd">launchd</a> and
many Linux distributions,
including Ubuntu,
use <a href="https://en.wikipedia.org/wiki/Systemd">systemd</a>.</p>
<p><strong>systemd</strong> does more than handle the startup process,
it also manages various services and connects
the Linux kernel to various applications.
In this section,
we'll cover how to use <strong>systemd</strong> to manage services, and
to review log files.</p>
<a class="header" href="18-using-systemd.html#manage-services" id="manage-services"><h2>Manage Services</h2></a>
<p>When we install complicated software,
like a web server (e.g., Apache2, Nginx),
a SSH server (e.g., OpenSSH), or
a database server (e.g., mariaDB or MySQL),
then it's helpful to have commands that manage that service
(the web service, the SSH service, the database service, etc).</p>
<p>For example, the <code>ssh</code> service is installed
by default on our gcloud servers, and
we can check its status with the following
<code>systemctl</code> command:</p>
<pre><code>systemctl status ssh
</code></pre>
<p>The output tells us a few things.
The line beginning with <strong>Loaded</strong> tells us that
the SSH service is configured.
At the end of that line,
it also tells us that it is <strong>enabled</strong>,
which means that the service will automatically start
when the system gets rebooted or starts up.</p>
<p>The line beginning with <strong>Active</strong> tells us
that the service is <strong>active (running)</strong> and for how long.
It has to say this since I'm connecting to the machine
using <code>ssh</code>.
If the service was not active (running), then
I wouldn't be able to login remotely.
We also can see the process ID (PID) for the service
as well as how much memory it's using.</p>
<p>At the bottom of the output,
we can see the recent log files.
We can view more of those log files
using the <code>journalctl</code> command.
By default, running <code>journalctl</code> by itself
will return all log files, but
we can specify that we're interested in
log files only for the ssh service.
We can specify using the PID number.
Replace <em>NNN</em> with the PID number attached
to your ssh service:</p>
<pre><code>journalctl _PID=NNN
</code></pre>
<p>Or we can specify by service, or
more specifically, its <strong>unit</strong> name:</p>
<pre><code>journalctl -u ssh
</code></pre>
<a class="header" href="18-using-systemd.html#use-cases" id="use-cases"><h3>Use Cases</h3></a>
<p>Later we'll install the <a href="https://httpd.apache.org/">Apache web server</a>, and
we will use <code>systemctl</code> to manage some aspects of this service.</p>
<p>In particular, we will use the following commands to:</p>
<ol>
<li>check the state of the Apache service,</li>
<li>configure the Apache service to auto start on reboot,</li>
<li>start the service,</li>
<li>reload the service after editing its configuration files, and</li>
<li>stop the service.</li>
</ol>
<p>In order, these work out to:</p>
<pre><code>systemctl status apache2
sudo systemctl enable apache2
sudo systemctl start apache2
sudo systemctl reload apache2
sudo systemctl stop apache2
</code></pre>
<p><code>systemctl</code> is a big piece of software, and
there are other arguments the command will take.
See <code>man systemct</code> for details.</p>
<a class="header" href="18-using-systemd.html#examine-logs" id="examine-logs"><h2>Examine Logs</h2></a>
<p>As mentioned, the <code>journalctl</code> command is
part of the <strong>systemd</strong> software suite, and
it is used to monitor system logs.</p>
<p>It's really important to monitor system logs.
They help identify any problems in the system or
with various services.
For example, by monitoring the log entries for <strong>ssh</strong>,
I can see all the attempts to break into the server.
Or if the Apache2 web server malfunctions for some reason,
which might be because of a configuration error,
the logs will indicated how to identify the problem.</p>
<p>If we type <code>journalctl</code> at the command prompt,
we are be presented with the logs for the entire system.
These logs can be paged through by pressing the space bar,
the page up/page down keys, or
the up/down arrow keys, and
they can also be searched by pressing the forward slash <strong>/</strong> and
then entering a search keyword.
To exit out of the pager,
press <strong>q</strong> to quit.</p>
<pre><code>journalctl
</code></pre>
<p>It's much more useful to specify the field and
to declare an option when using <code>journalctl</code>.
See the following man pages for details:</p>
<pre><code>man systemd.journal-fields
man journalctl
</code></pre>
<p>There are many fields and options we can use, but
as an example,
we see that there is an option to view the more
recent entries first (which is not the default):</p>
<pre><code>journalctl -r
</code></pre>
<p>Or we view log entries in reverse order,
for users on the system, and
since the last boot with the following options:</p>
<pre><code>journalctl -r --user -b 0
</code></pre>
<p>Or for the system:</p>
<pre><code>journalctl -r --system -b 0
</code></pre>
<p>I can more specifically look at the
logs files for a service by using the <code>-u</code>
option with <code>journalctl</code>:</p>
<pre><code>journalctl -u apache2
</code></pre>
<p>I can follow the logs in real-time
(press <strong>ctrl-c</strong> to quit the real-time view):</p>
<pre><code>journalctl -f
</code></pre>
<a class="header" href="18-using-systemd.html#useful-systemd-commands" id="useful-systemd-commands"><h2>Useful Systemd Commands</h2></a>
<p>You can see more of what <code>systemctl</code> or <code>journalctl</code>
can do by reading through their documentation:</p>
<pre><code>man systemctl
man journalctl
</code></pre>
<p>You can check if a service if enabled:</p>
<pre><code>systemctl is-enabled apache2
</code></pre>
<p>You can reboot, poweroff, or suspend a system
(suspending a system mostly makes sense for laptops
and not servers):</p>
<pre><code>systemctl reboot
systemctl poweroff
systemctl suspend
</code></pre>
<p>To show configuration file changes to the system:</p>
<pre><code>systemd-delta
</code></pre>
<p>To list real-time control group process, resource usage, and memory usage:</p>
<pre><code>systemd-cgtop
</code></pre>
<ul>
<li>to search failed processes/services:</li>
</ul>
<pre><code>systemctl --state failed
</code></pre>
<ul>
<li>to list services</li>
</ul>
<pre><code>systemctl list-unit-files -t service
</code></pre>
<ul>
<li>to examine boot time:</li>
</ul>
<pre><code>systemd-analyze
</code></pre>
<a class="header" href="18-using-systemd.html#conclusion" id="conclusion"><h2>Conclusion</h2></a>
<p>This is a basic introduction to <strong>systemd</strong>,
which is composed of a suite of software to help
manage booting a system, managing services, and
monitoring logs.</p>
<p>We'll put what we've learned into practice
when we set up our LAMP servers.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="17-managing-software.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="p5-networking-security.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="17-managing-software.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="p5-networking-security.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
