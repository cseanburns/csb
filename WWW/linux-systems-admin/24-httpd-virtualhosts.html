<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Apache2 and Virtual Hosts - Linux Systems Administration</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="linux-sysadmin.html"><strong aria-hidden="true">1.</strong> Linux Systems Administration</a></li><li class="chapter-item expanded "><a href="p1-system-basics.html"><strong aria-hidden="true">2.</strong> System Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="01-history-linux-unix.html"><strong aria-hidden="true">2.1.</strong> History of Unix and Linux</a></li><li class="chapter-item expanded "><a href="02-quick-ssh-connect.html"><strong aria-hidden="true">2.2.</strong> Connect to a Remote Server</a></li><li class="chapter-item expanded "><a href="03-filesystem-file-management.html"><strong aria-hidden="true">2.3.</strong> Linux Filesystems and File Management</a></li><li class="chapter-item expanded "><a href="04-file-attributes.html"><strong aria-hidden="true">2.4.</strong> File Attributes</a></li><li class="chapter-item expanded "><a href="05-text-processing-part-1.html"><strong aria-hidden="true">2.5.</strong> Text Processing, Part 1</a></li><li class="chapter-item expanded "><a href="06-text-processing-part-2.html"><strong aria-hidden="true">2.6.</strong> Text Processing, Part 2</a></li><li class="chapter-item expanded "><a href="07-text-editors.html"><strong aria-hidden="true">2.7.</strong> Text Editors</a></li><li class="chapter-item expanded "><a href="08-revisiting-paths.html"><strong aria-hidden="true">2.8.</strong> Revisiting Paths</a></li><li class="chapter-item expanded "><a href="09-bash-scripting.html"><strong aria-hidden="true">2.9.</strong> Bash Scripting</a></li><li class="chapter-item expanded "><a href="10-regular-expressions.html"><strong aria-hidden="true">2.10.</strong> Regular Expressions</a></li></ol></li><li class="chapter-item expanded "><a href="p2-managing-services-software.html"><strong aria-hidden="true">3.</strong> Managing Services and Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="11-installing-linux.html"><strong aria-hidden="true">3.1.</strong> Installing Linux in VirtualBox</a></li><li class="chapter-item expanded "><a href="12-logical-volumes.html"><strong aria-hidden="true">3.2.</strong> Logical Volume Management</a></li><li class="chapter-item expanded "><a href="13-virtualbox-nat.html"><strong aria-hidden="true">3.3.</strong> Using NAT in VirtualBox</a></li><li class="chapter-item expanded "><a href="14-webconsole-nat.html"><strong aria-hidden="true">3.4.</strong> NAT Table in VirtualBox</a></li><li class="chapter-item expanded "><a href="15-managing-users-groups.html"><strong aria-hidden="true">3.5.</strong> Managing Users and Groups</a></li><li class="chapter-item expanded "><a href="16-systemd.html"><strong aria-hidden="true">3.6.</strong> systemd</a></li><li class="chapter-item expanded "><a href="17-backup-and-using-dnf.html"><strong aria-hidden="true">3.7.</strong> Backups and DNF</a></li></ol></li><li class="chapter-item expanded "><a href="p3-networking-security.html"><strong aria-hidden="true">4.</strong> Networking and Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="18-tcip-networking.html"><strong aria-hidden="true">4.1.</strong> TCIP Networking</a></li><li class="chapter-item expanded "><a href="19-networking-dns-domains.html"><strong aria-hidden="true">4.2.</strong> DNS and Domain Names</a></li><li class="chapter-item expanded "><a href="20-security-chroot.html"><strong aria-hidden="true">4.3.</strong> Security and chroot</a></li><li class="chapter-item expanded "><a href="21-security-firewall.html"><strong aria-hidden="true">4.4.</strong> Security and Firewalls</a></li></ol></li><li class="chapter-item expanded "><a href="p4-lamp.html"><strong aria-hidden="true">5.</strong> Creating a LAMP Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="22-httpd-apache.html"><strong aria-hidden="true">5.1.</strong> Apache2 Web Server</a></li><li class="chapter-item expanded "><a href="23-httpd-php.html"><strong aria-hidden="true">5.2.</strong> Apache2 and PHP</a></li><li class="chapter-item expanded "><a href="24-httpd-virtualhosts.html" class="active"><strong aria-hidden="true">5.3.</strong> Apache2 and Virtual Hosts</a></li><li class="chapter-item expanded "><a href="25-httpd-mysql.html"><strong aria-hidden="true">5.4.</strong> Apache2 and MySQL</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="apache2-virtualhosts"><a class="header" href="#apache2-virtualhosts">Apache2 VirtualHosts</a></h1>
<p>In this tutorial, we use VirtualHosts so that our server may support
multiple domain names.</p>
<p>We do this by configuring Apache2 to recognize new DocumentRoot
directories for the additional domain names.</p>
<p>This allows us to serve multiple websites based on the same IP address.</p>
<h2 id="update-os"><a class="header" href="#update-os">Update OS</a></h2>
<p>As always, we need to keep our Fedora installation updated: </p>
<pre><code>dnf upgrade
</code></pre>
<h2 id="create-new-configurations"><a class="header" href="#create-new-configurations">Create new configurations</a></h2>
<p>So far we have learned how to create a main website at the following
document root:</p>
<p><strong>/var/www/html</strong> </p>
<p>We have also learned how to enable Apache2 to serve websites from user
directories:</p>
<p><strong>/home/USER/public_html/</strong>.</p>
<p>Websites that are stored at <strong>/var/www/html</strong> can eventually have a
domain name like <strong>example.org</strong> or <strong>biguniversity.edu</strong>. And then
websites at <strong>/home/USER/public_html/</strong> would have URLs like
<code>http://biguniversity.edu/~USER</code>.</p>
<p>The problem with creating a website at the <strong>/var/www/html</strong> DocumentRoot
is that, by default, we can only create the one main site; so either
<strong>example.org</strong> or <strong>biguniversity.edu</strong> but not both.</p>
<p><em>VirtualHosts</em> solve this problem. It allows a single server, with a
single IP address, to host websites linked to multiple domain names,
where all of these sites would have their own DocumentRoot directories
in the <strong>/var/www/html</strong> directory.</p>
<p>To start, we need to revisit the Apache configuration files and add
information about the VirtualHosts that we want to create. </p>
<p>We begin by adding VirtualHost information to the following file:</p>
<pre><code>less /etc/httpd/conf/httpd.conf
</code></pre>
<p>That file includes the following line:</p>
<ul>
<li><code>IncludeOptional conf.d/*.conf</code></li>
</ul>
<p>That option tells the Apache2 service to look for additional configuration
files in the <strong>conf.d/</strong> directory. Per that above line, the configuration
files that we add will need to end with <strong>.conf</strong>.</p>
<p>To get started, we'll name the files after some pretend domain names. I'll
create a domain called <strong>linuxonenterprise.com</strong> and another one called
<strong>websysadmins.com</strong>:</p>
<pre><code>cd /etc/httpd/conf.d/
touch linuxonenterprise.conf
</code></pre>
<p>In the <strong>linuxonenterprise.conf</strong> file, I'll add the following info:</p>
<pre><code>&lt;VirtualHost *:80&gt;
ServerAdmin webmaster@linuxonenterprise.com
DocumentRoot &quot;/var/www/html/linuxonenterprise/&quot;
ServerName linuxonenterprise.com
ServerAlias www.linuxonenterprise.com
ErrorLog &quot;/var/log/httpd/linuxonenterprise.com-error_log&quot;
CustomLog &quot;/var/log/httpd/linuxonenterprise.com-access_log&quot; combined

&lt;Directory &quot;/var/www/html/linuxonenterprise/&quot;&gt;
DirectoryIndex index.php index.html
Options FollowSymLinks
AllowOverride All
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
<p>Then I'll repeat the process with a new file called <strong>websysadmins.conf</strong>.
To make life easier, I can copy the <strong>linuxonenterprise.conf</strong> to
<strong>websysadmins.conf</strong>.</p>
<pre><code>cp linuxonenterprise.conf websysadmins.conf
</code></pre>
<p>And edit the websysadmins.conf file accordingly by replacing the names
of the site:</p>
<pre><code>&lt;VirtualHost *:80&gt;
ServerAdmin webmaster@websysadmins.com
DocumentRoot &quot;/var/www/html/websysadmins/&quot;
ServerName websysadmins.com
ServerAlias www.websysadmins.com
ErrorLog &quot;/var/log/httpd/websysadmins.com-error_log&quot;
CustomLog &quot;/var/log/httpd/websysadmins.com-access_log&quot; combined

&lt;Directory &quot;/var/www/html/websysadmins/&quot;&gt;
DirectoryIndex index.html index.php
Options FollowSymLinks
AllowOverride All
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
<p>When done, I'll exit out of my text editor and check the configuration
syntax with one of the following two commands:</p>
<pre><code>httpd -t
apachectl configtest
</code></pre>
<p>You should get an error stating that the sites don't exist at the
<strong>DocumentRoot</strong>, but we'll fix that in a second. For now, you want to get
a <code>Syntax OK</code> message.</p>
<h2 id="creating-the-sites"><a class="header" href="#creating-the-sites">Creating the sites</a></h2>
<p>The above two files tell Apache2 to look for the two websites
in:</p>
<ul>
<li><code>/var/www/html/linuxonenterprise</code></li>
<li><code>/var/www/html/websysadmins</code></li>
</ul>
<p>These are the <strong>DocumentRoot</strong>, i.e., the base directories for our
websites. We need to create those locations. I'll do that now for my
two domains, and I'll use Bash brace expansion to create both at the
same time:</p>
<pre><code>mkdir /var/www/html/{linuxonenterprise,websysadmins}
</code></pre>
<p>The above command creates two directories:</p>
<ul>
<li>/var/www/html/linuxonenterprise</li>
<li>/var/www/html/websysadmins</li>
</ul>
<p>Now create some basic web pages in each domain directory:</p>
<pre><code>cd /var/www/html/linuxonenterprise
echo &quot;&lt;h1&gt;Linux on the Enterprise&lt;/h1&gt;&quot; &gt;&gt; index.html
</code></pre>
<p>Then <code>cd</code> to <strong>websysadmins</strong> from the <strong>linuxonenterprise</strong> directory:</p>
<pre><code>cd ../websysadmins
echo &quot;&lt;h1&gt;Web Sys Admins&lt;/h1&gt;&quot; &gt;&gt; index.html
</code></pre>
<p>And now we have to make sure that the user <code>apache</code> owns
those two directories and all future files in them. We use
the user <code>apache</code> because the main Apache2 configuration file
(<code>/etc/httpd/conf/httpd.conf</code>) has two directives that state that the
names of the User/Group should be <code>apache</code>:</p>
<pre><code>cd .. # to return to the parent directory
chgrp -R apache /var/www/html/
chmod 2775 -R /var/www/html
</code></pre>
<p>By adding our account to the <code>apache</code> group, we can edit these and all
future files without using <code>sudo</code> or becoming <code>root</code>. Here I make user
'sean' part of the <code>apache</code> group:</p>
<pre><code>usermod -a -G apache sean
</code></pre>
<p>This group addition will not go into effect until the user logs out and
logs back in.</p>
<p>You can run <code>ls -ld</code> and <code>ls -l</code> on those directories and files to
confirm that the <code>apache</code> owner owns them. You can also run <code>httpd -t</code>
or <code>apachectl configtest</code> again to confirm that all the syntax is good.</p>
<h2 id="the-hosts-file-etchosts"><a class="header" href="#the-hosts-file-etchosts">The Hosts File: <code>/etc/hosts</code></a></h2>
<p>In order to resolve IP address to domain names, we need some kind of
system that will map these two identifiers to each other. We have already
covered DNS more extensively, but since we're not really creating new
websites for the web, we'll repeat what we did in the previous weeks
with the <code>/etc/hosts</code> file.</p>
<p>The <code>/etc/hosts</code> file is like a basic DNS system and we can use as a
&quot;static table lookup for hostnames&quot; (from <code>man hosts</code>). Let's modify
this so that our IP address is mapped to the our domain names. To do
that, let's add the following line just after the two localhost lines:
(<strong>USE YOUR IP NOT MINE</strong>)</p>
<pre><code>ip a
192.168.4.32
sudo nano /etc/hosts
</code></pre>
<p>Then let's map the IP address to the hostnames that we'll use for the
new websites.  Add the following to <code>/etc/hosts</code>, but replace my IP
with yours and my hostname with one of your own creation:</p>
<pre><code>192.168.4.32 linuxonenterprise.com
192.168.4.32 websysadmins.com
</code></pre>
<p>This is one way to create a kind of intranet that uses actual names instead of
just IP addresses. Say that you have a home network and one of the computers on
your network is running a web server. If you assign a static IP to this
computer using the software on your home router, modify the <code>/etc/hosts</code>
files on each of those three computers to point to that static IP via a domain
name, then you have basic DNS system for your subnet.</p>
<p>Now, let's restart Apache2 and see if we can visit our sites.</p>
<pre><code>systemctl reload httpd.service
systemctl restart httpd.service
w3m http://linuxonenterprise.com
w3m http://websysadmins.com
</code></pre>
<p>Success!</p>
<p>If you change the <code>/etc/hosts</code> file on your <strong>host</strong> machine (i.e., your
laptop) per the instructions in the last lecture, then you should be able to
visit <code>http://linuxonenterprise.com</code> and <code>http://websysadmins.com</code> in your
browser. Here is a snippet of what my <code>/etc/hosts</code> file looks like on my
desktop machine (i.e., my <strong>host</strong> machine):</p>
<pre><code>127.0.0.1      localhost
127.0.1.1      desktop
192.168.4.32    linuxonenterprise.com
192.168.4.32    websysadmins.com
</code></pre>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://httpd.apache.org/docs/2.2/vhosts/name-based.html">Name-based Virtual Host Support</a></li>
<li><a href="https://httpd.apache.org/docs/2.4/vhosts/examples.html">VirtualHost Examples</a></li>
<li><a href="https://www.rosehosting.com/blog/apache-virtual-hosts-on-centos/">How to set up Apache Virtual Hosts on CentOS 7</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="23-httpd-php.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="25-httpd-mysql.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="23-httpd-php.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="25-httpd-mysql.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
