<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Apache2 Web Server - Linux Systems Administration</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="linux-sysadmin.html"><strong aria-hidden="true">1.</strong> Linux Systems Administration</a></li><li class="chapter-item expanded "><a href="p1-system-basics.html"><strong aria-hidden="true">2.</strong> System Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="01-history-linux-unix.html"><strong aria-hidden="true">2.1.</strong> History of Unix and Linux</a></li><li class="chapter-item expanded "><a href="02-quick-ssh-connect.html"><strong aria-hidden="true">2.2.</strong> Connect to a Remote Server</a></li><li class="chapter-item expanded "><a href="03-filesystem-file-management.html"><strong aria-hidden="true">2.3.</strong> Linux Filesystems and File Management</a></li><li class="chapter-item expanded "><a href="04-file-attributes.html"><strong aria-hidden="true">2.4.</strong> File Attributes</a></li><li class="chapter-item expanded "><a href="05-text-processing-part-1.html"><strong aria-hidden="true">2.5.</strong> Text Processing, Part 1</a></li><li class="chapter-item expanded "><a href="06-text-processing-part-2.html"><strong aria-hidden="true">2.6.</strong> Text Processing, Part 2</a></li><li class="chapter-item expanded "><a href="07-text-editors.html"><strong aria-hidden="true">2.7.</strong> Text Editors</a></li><li class="chapter-item expanded "><a href="08-revisiting-paths.html"><strong aria-hidden="true">2.8.</strong> Revisiting Paths</a></li><li class="chapter-item expanded "><a href="09-bash-scripting.html"><strong aria-hidden="true">2.9.</strong> Bash Scripting</a></li><li class="chapter-item expanded "><a href="10-regular-expressions.html"><strong aria-hidden="true">2.10.</strong> Regular Expressions</a></li></ol></li><li class="chapter-item expanded "><a href="p2-managing-services-software.html"><strong aria-hidden="true">3.</strong> Managing Services and Software</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="11-installing-linux.html"><strong aria-hidden="true">3.1.</strong> Installing Linux in VirtualBox</a></li><li class="chapter-item expanded "><a href="12-logical-volumes.html"><strong aria-hidden="true">3.2.</strong> Logical Volume Management</a></li><li class="chapter-item expanded "><a href="13-virtualbox-nat.html"><strong aria-hidden="true">3.3.</strong> Using NAT in VirtualBox</a></li><li class="chapter-item expanded "><a href="14-webconsole-nat.html"><strong aria-hidden="true">3.4.</strong> NAT Table in VirtualBox</a></li><li class="chapter-item expanded "><a href="15-managing-users-groups.html"><strong aria-hidden="true">3.5.</strong> Managing Users and Groups</a></li><li class="chapter-item expanded "><a href="16-systemd.html"><strong aria-hidden="true">3.6.</strong> systemd</a></li><li class="chapter-item expanded "><a href="17-backup-and-using-dnf.html"><strong aria-hidden="true">3.7.</strong> Backups and DNF</a></li></ol></li><li class="chapter-item expanded "><a href="p3-networking-security.html"><strong aria-hidden="true">4.</strong> Networking and Security</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="18-tcip-networking.html"><strong aria-hidden="true">4.1.</strong> TCIP Networking</a></li><li class="chapter-item expanded "><a href="19-networking-dns-domains.html"><strong aria-hidden="true">4.2.</strong> DNS and Domain Names</a></li><li class="chapter-item expanded "><a href="20-security-chroot.html"><strong aria-hidden="true">4.3.</strong> Security and chroot</a></li><li class="chapter-item expanded "><a href="21-security-firewall.html"><strong aria-hidden="true">4.4.</strong> Security and Firewalls</a></li></ol></li><li class="chapter-item expanded "><a href="p4-lamp.html"><strong aria-hidden="true">5.</strong> Creating a LAMP Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="22-httpd-apache.html" class="active"><strong aria-hidden="true">5.1.</strong> Apache2 Web Server</a></li><li class="chapter-item expanded "><a href="23-httpd-php.html"><strong aria-hidden="true">5.2.</strong> Apache2 and PHP</a></li><li class="chapter-item expanded "><a href="24-httpd-virtualhosts.html"><strong aria-hidden="true">5.3.</strong> Apache2 and Virtual Hosts</a></li><li class="chapter-item expanded "><a href="25-httpd-mysql.html"><strong aria-hidden="true">5.4.</strong> Apache2 and MySQL</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="installing-apache2"><a class="header" href="#installing-apache2">Installing Apache2</a></h1>
<p>Let's install our first web server.</p>
<p>First, switch to Bridged mode in VirtualBox network settings and refresh
MAC address in VirtualBox.</p>
<h2 id="update-system-first"><a class="header" href="#update-system-first">Update system first</a></h2>
<p>Make sure your machine is up to date before installing Apache2.</p>
<p>Login as root, or switch to the <code>root</code> user, and update the machine:</p>
<pre><code>sudo su
dnf update
</code></pre>
<h2 id="install-httpd"><a class="header" href="#install-httpd">Install <code>httpd</code></a></h2>
<p>Now, that the machine is updated, install Apache2. On distributions that
use a package management system, such as <code>dnf</code> on Fedora and <code>apt</code>
on Ubuntu, we can use those systems to install the relevant software
and dependencies. However, different distributions use different names
for the packages. Fedora refers to the Apache2 package as <code>httpd</code>
while Ubuntu refers to it as <code>Apache2</code>. We can use <code>dnf</code> to search
for the appropriate package name:</p>
<pre><code>dnf search apache | grep &quot;httpd&quot;
</code></pre>
<p>Apache2 is not the only web server available. <a href="https://nginx.org/en/">nginx</a> is another
popular web server, and you should explore or learn about other options
on your own.  For now, let's get some basic info on the <code>httpd</code> package:</p>
<pre><code>dnf info httpd
</code></pre>
<p>Based on the output, and at the time of this writing, it looks like the
<code>httpd</code> package refers to the Apache HTTP Server, version 2.4.51. I
want to highlight this because it's important to know what version of
things are that we're installing, for a couple of reasons at least:</p>
<ol>
<li>
<p>First, although Apache2 has its own dependencies, other packages
will also depend on it. For example, say we wanted to install Drupal or
WordPress, we would first have to install a web server, like Apache2,
and it might be the case that Drupal or WordPress require a certain
minimum version of Apache2.</p>
</li>
<li>
<p>Second, some Linux operating systems focus on stability and thus do
not update to the most recent version of a package instead opting for
the most stable version of the software. The <a href="https://httpd.apache.org/">latest stable release of
Apache2</a> is 2.4.51. But it's not always likely that Fedora or
some other distribution will use that or some newer version until the
next distribution upgrade, for example, from Fedora 33 to Fedora 34.
For now, this is fine, and we can proceed with the install:</p>
</li>
</ol>
<pre><code>dnf -y install httpd
</code></pre>
<h2 id="basic-checks"><a class="header" href="#basic-checks">Basic checks</a></h2>
<p>One of the things that makes Apache2, and some other web servers, powerful
is the library of modules that extend Apache's functionality. We'll come
back to modules soon. For now, we're going to make sure the server is
up and running, configure some basic things, and then create a basic
web site.</p>
<p>To start, let's get some info about Apache2 and make sure it is <em>enabled</em>
and <em>running</em>:</p>
<pre><code>systemctl list-unit-files httpd.service
systemctl enable httpd.service
systemctl list-unit-files httpd.service
systemctl status httpd.service
systemctl start httpd.service
systemctl status httpd.service
</code></pre>
<h2 id="creating-a-web-page"><a class="header" href="#creating-a-web-page">Creating a web page</a></h2>
<p>Now that we have it up and running, let's look at the default web
page. We can use our loopback IP address (aka, <em>localhost</em>) and the
<code>w3m</code> text web browser to view the default page:</p>
<pre><code>dnf install -y w3m
w3m http://127.0.0.1
w3m http://localhost/
</code></pre>
<p>The <code>w3m</code> text-mode browser shows the <strong>Fedora Test Page</strong>. That's
a sign that the default install was successful.</p>
<p>Let's now create our first web page.  To do so, we need to know what
directory that <code>httpd</code> is using to serve websites. This directory is
called the <strong>DocumentRoot</strong> directory. If we read through that <strong>Fedora
Test Page</strong> document, it'll tell us that the default directory is
<code>/var/www/html/</code>. Let's go there and create a webpage with our text
editor of choice:</p>
<pre><code>cd /var/www/html/
nano index.html
</code></pre>
<p>Create a simple HTML page, something like this. Of course, modify the
content to suit your own interests:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;My first web page using Apache2&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;Welcome&lt;/h1&gt;

&lt;p&gt;Welcome to my web site. I have ever created using Apache2 and Fedora
Linux.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Dr. Burns&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>After you're done, save and close the document. Let's visit our website
again with <code>w3m</code> to see if it works:</p>
<pre><code>w3m http://127.0.0.1
</code></pre>
<p>Let's open the firewall so that outside systems can access this page:</p>
<pre><code>firewall-cmd --list-all
firewall-cmd --get-active-zones
firewall-cmd --zone=FedoraServer --add-service=http
firewall-cmd --zone=FedoraServer --add-service=https
firewall-cmd --runtime-to-permanent
</code></pre>
<h2 id="changing-the-hostname"><a class="header" href="#changing-the-hostname">Changing the <code>hostname</code></a></h2>
<p>The <code>hostname</code> of a system is the label it uses to identify itself
to others (humans) on a (sub)network. If the hostname is on the web (or
the internet), it may also be part of its of the fully qualified domain
name (FQDN), which we studied during the DNS and networking weeks. For
example, on a server identified as <strong>enterprise.example.net</strong>, then
<strong>enterprise</strong>, is the hostname, <strong>example.net</strong> is the domain name,
and <strong>enterprise.example.net</strong> is the fully qualified domain name. If
two computers are on the same subnet, then they can be reachable via
the hostname only, but the domain name is part of the DNS system and is
required for two computers on the broader internet to reach each other.</p>
<p>We're going to check and set the system <code>hostname</code> on our Fedora
(virtual) machines using the <code>hostname</code> and <code>hostnamectl</code> commands:</p>
<p>Check the default hostname:</p>
<pre><code># hostname
localhost.localdomain
</code></pre>
<p>To change the default hostname from <strong>localhost</strong>, use the <code>hostnamectl</code>
command to update the system's hostname per the file. My new hostname
will be <strong>enterprise</strong>.  You can name your hostname whatever you want,
but be sure it's a single word with no punctuation.</p>
<pre><code>hostnamectl set-hostname enterprise
hostname
cat /etc/hostname
</code></pre>
<p>We can access our site by hostname rather than by IP:</p>
<pre><code>w3m http://enterprise
</code></pre>
<h3 id="optional"><a class="header" href="#optional">Optional</a></h3>
<p>After you've completed the above steps, do the following:</p>
<ol>
<li>
<p>On your host machine, find your OS's version of <code>/etc/hosts</code>. </p>
<ul>
<li>Windows instructions: <a href="https://gist.github.com/zenorocha/18b10a14b2deb214dc4ce43a2d2e2992">https://gist.github.com/zenorocha/18b10a14b2deb214dc4ce43a2d2e2992</a>.</li>
<li>macOS users can edit their <code>/etc/hosts</code> file.</li>
</ul>
</li>
<li>
<p>Map your guest IP address (your Fedora IP) to your new hostname:</p>
<pre><code>192.168.4.31 enterprise
</code></pre>
</li>
</ol>
<p>Then, in your Firefox, Chrome, or whatever browser, visit your new
website and replace <strong>enterprise</strong> with the hostname that you chose for
your guest OS:</p>
<pre><code>http://enterprise
</code></pre>
<h2 id="apache2-user-directories"><a class="header" href="#apache2-user-directories">Apache2 User Directories</a></h2>
<p>We can enable Apache2 so that users on our systems can run websites from
their home directories; that is, sites located at:</p>
<ul>
<li><code>$HOME/public_html</code></li>
</ul>
<h3 id="enable-userdir"><a class="header" href="#enable-userdir">Enable userdir</a></h3>
<p>Edit the <code>userdir.conf</code> file.</p>
<pre><code>cd /etc/httpd/conf.d/
nano userdir.conf
</code></pre>
<p>Make the following changes:</p>
<ul>
<li><code>UserDir disabled</code> to <code>UserDir enabled</code></li>
<li>Uncomment line <code>UserDir public_html</code></li>
</ul>
<p>After saving and exiting, restart <code>httpd.service</code>:</p>
<pre><code>systemctl restart httpd.service
</code></pre>
<h2 id="tasks"><a class="header" href="#tasks">Tasks</a></h2>
<ol>
<li>Exit out of root account</li>
<li>Go to your regular user's home directory</li>
<li>Make a directory titled <code>public_html</code> if it doesn't already exist</li>
<li>Set <code>public_html</code> directory permissions to 755:
<ul>
<li><code>chmod 755 public_html</code></li>
</ul>
</li>
<li>Change the user's directory permissions to 701:
<ul>
<li><code>chmod 701 /home/your_user</code></li>
</ul>
</li>
</ol>
<p><strong>SELinux</strong> needs to be configured to allow web access to our home
directories. Specifically, we need to set some SELinux switches. Using
<code>sudo</code> or logging in as <code>root</code>. Make sure you replace <strong>sean</strong>
with your username:</p>
<pre><code>setsebool -P httpd_enable_homedirs true
chcon -R -t httpd_sys_content_t /home/sean/public_html
</code></pre>
<p>Exit out of root if you need to.</p>
<h3 id="test"><a class="header" href="#test">Test</a></h3>
<p>Now test to see if your <code>public_html</code> site is operational by simply
visiting the site. For me, I use the following command:</p>
<pre><code>cd ~/public_html/
echo &quot;&lt;p&gt;Hello world&lt;/p&gt;&quot; &gt;&gt; index.html
w3m http://127.0.0.1/~sean
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="p4-lamp.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="23-httpd-php.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="p4-lamp.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="23-httpd-php.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
