<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>systemd - Linux Systems Administration</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Book on entry level Linux systems administration work.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./linux-sysadmin.html"><strong>1.</strong> Linux Systems Administration</a></li><li><a href="./p1-system-basics.html"><strong>2.</strong> System Basics</a></li><li><ul class="section"><li><a href="./01-history-linux-unix.html"><strong>2.1.</strong> History of Unix and Linux</a></li><li><a href="./02-quick-ssh-connect.html"><strong>2.2.</strong> Connect to a Remote Server</a></li><li><a href="./03-filesystem-file-management.html"><strong>2.3.</strong> Linux Filesystems and File Management</a></li><li><a href="./04-file-attributes.html"><strong>2.4.</strong> File Attributes</a></li><li><a href="./05-text-processing-part-1.html"><strong>2.5.</strong> Text Processing, Part 1</a></li><li><a href="./06-text-processing-part-2.html"><strong>2.6.</strong> Text Processing, Part 2</a></li><li><a href="./07-text-editors.html"><strong>2.7.</strong> Text Editors</a></li><li><a href="./08-revisiting-paths.html"><strong>2.8.</strong> Revisiting Paths</a></li><li><a href="./09-bash-scripting.html"><strong>2.9.</strong> Bash Scripting</a></li><li><a href="./10-regular-expressions.html"><strong>2.10.</strong> Regular Expressions</a></li></ul></li><li><a href="./p2-managing-services-software.html"><strong>3.</strong> Managing Services and Software</a></li><li><ul class="section"><li><a href="./11-using-gcloud.html"><strong>3.1.</strong> Using gcloud for Virtual Machines</a></li><li><a href="./12-expanding-storage.html"><strong>3.2.</strong> Expanding Storage</a></li><li><a href="./15-managing-users-groups.html"><strong>3.3.</strong> Managing Users and Groups</a></li><li><a href="./16-systemd.html" class="active"><strong>3.4.</strong> systemd</a></li><li><a href="./17-backup-and-using-dnf.html"><strong>3.5.</strong> Backups and DNF</a></li></ul></li><li><a href="./p3-networking-security.html"><strong>4.</strong> Networking and Security</a></li><li><ul class="section"><li><a href="./18-tcip-networking.html"><strong>4.1.</strong> TCIP Networking</a></li><li><a href="./19-networking-dns-domains.html"><strong>4.2.</strong> DNS and Domain Names</a></li><li><a href="./20-security-chroot.html"><strong>4.3.</strong> Security and chroot</a></li><li><a href="./21-security-firewall.html"><strong>4.4.</strong> Security and Firewalls</a></li></ul></li><li><a href="./p4-lamp.html"><strong>5.</strong> Creating a LAMP Server</a></li><li><ul class="section"><li><a href="./22-httpd-apache.html"><strong>5.1.</strong> Apache2 Web Server</a></li><li><a href="./23-httpd-php.html"><strong>5.2.</strong> Apache2 and PHP</a></li><li><a href="./24-httpd-virtualhosts.html"><strong>5.3.</strong> Apache2 and Virtual Hosts</a></li><li><a href="./25-httpd-mysql.html"><strong>5.4.</strong> Apache2 and MySQL</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./16-systemd.html#systemd" id="systemd"><h1>systemd</h1></a>
<ul>
<li><strong>systemd</strong> is an init system that aims to provide better boot time and a better way to manage services and processes.</li>
<li><strong>systemd</strong> is a replacement of the <strong>System V like init</strong> system that most Linux distributions used.</li>
<li><strong>systemd</strong> includes additional utilities to help manage services on a Linux system; essentially, it's much more than an init system</li>
</ul>
<p>There are only two basic aspects of <strong>systemd</strong> that I want to cover in this lesson, but know that <strong>systemd</strong> is a big, complicated suite of software that provides a lot of functions. In this lesson, though, we will cover using <strong>systemd</strong> to:</p>
<ol>
<li>manage services</li>
<li>examine logs</li>
</ol>
<a class="header" href="./16-systemd.html#manage-services" id="manage-services"><h2>Manage Services</h2></a>
<p>When we install a complicated piece of software like a web server (e.g., Apache2), a SSH server (e.g., openssh-server), or a database server (e.g., MySQL), then it's helpful if we have some commands that will help us manage that service (the web service/server, the SSH service/server, etc).</p>
<p>For example, after installing a SSH server, we might like to know if it's running, or we might want to stop it if it's running, or start it if it's not. Let's see what that looks like. In the following commands, I will use the <code>dnf</code> utility to install the <code>openssh-server</code>. Then I will check the status of the server using the <code>systemctl status</code> command. I will enable it so that it starts automatically when the operating system is rebooted using the <code>systemctl enable</code> command. Finally, I will make sure the firewall allows outside access to the operating system via <code>ssh</code>. I use the <code>sudo</code> command to run the relevant commands as administrator:</p>
<pre><code>dnf search openssh
sudo dnf install openssh-server
systemctl status sshd.service
sudo systemctl enable sshd.service
sudo firewall-cmd --add-service=ssh --permanent
</code></pre>
<p>There are similar commands to stop a service or to reload a service if a service configuration file has changed. As an example of the latter, let's say that I wanted to present a message to anyone who logs into my system remotely using <code>ssh</code>. In order to do that, I need to edit the main <code>ssh</code> configuration file, which is located in <strong>/etc/ssh/sshd_config</strong>:</p>
<pre><code>cd /etc/ssh
sudo nano sshd_config
</code></pre>
<p>Then I will remove the beginning pound sign and thus un-comment the following line:</p>
<pre><code>#Banner none
</code></pre>
<p>And replace it with a path a file that will contain my message:</p>
<pre><code>Banner /etc/ssh/ssh-banner
</code></pre>
<p>After saving and closing <strong>/etc/ssh/sshd_config</strong>, I will create and open the banner file using <code>nano</code>:</p>
<pre><code>sudo nano /etc/ssh/ssh-banner
</code></pre>
<p>And add the following:</p>
<pre><code>Unauthorized access to this system is not permitted and will be reported to the authorities.
</code></pre>
<p>Since we have changed a configuration for the <code>sshd.service</code>, we need to reload the service so that <code>sshd.service</code> becomes aware of the new configuration. To do that, I use <code>systemctl</code> like so:</p>
<pre><code>sudo systemctl reload sshd.service
</code></pre>
<p>Now, when you log into your Fedora system, you will see that new banner displayed.</p>
<a class="header" href="./16-systemd.html#examine-logs" id="examine-logs"><h2>Examine Logs</h2></a>
<p>The <code>journalctl</code> command is also part of the <strong>systemd</strong> software suite and is used to monitor logs on the system.</p>
<p>If we just type <code>journalctl</code> at the command prompt, we will be presented with the logs for the entire system. These logs can be paged through by pressing the space bar, the page up/page down keys, or the up/down arrow keys, and they can also be searched by pressing the forward slash <code>/</code>.</p>
<pre><code>journalctl
</code></pre>
<p>However, it's much better to use various options. If you <code>tab tab</code> after typing <code>journalctl</code>, command line completion will provide additional fields (see man page: <code>man 7 systemd.journal-fields</code> and see <code>man man</code> for numbering options) to examine logs for. There are many, but as an example, we see that there is an option called _UID=, which allows us to examine the logs for a user with a specific user id. For example, on our independent Fedora systems, our user ID numbers are 1000. So that means I can see the logs for my account by:</p>
<pre><code>journalctl _UID=1000
</code></pre>
<p>The above shows journal entries related to user ID of 1000, which is my user id. We can see other user IDs by concatenating (<code>cat</code>) the <strong>passwd</strong> file. Not only do real humans who have accounts on the system have user IDs, but many services do to. Here I look at journal entries for <code>chronyd</code>, with a user ID of 992. This is a service that manages the system's time:</p>
<pre><code class="language-bash">cat /etc/passwd
journalctl _UID=984
</code></pre>
<p>I can more specifically look at the logs files for a service by using the <code>-u</code> option with <code>journalctl</code>:</p>
<pre><code>journalctl -u sshd.service
</code></pre>
<p>I can examine logs since last boot:</p>
<pre><code>journalctl -b
</code></pre>
<p>Or I can follow the logs in real-time (press <strong>ctrl-c</strong> to quit the real-time view):</p>
<pre><code>journalctl -f
</code></pre>
<a class="header" href="./16-systemd.html#useful-systemd-commands" id="useful-systemd-commands"><h2>Useful Systemd Commands</h2></a>
<p>You can see more of what <code>systemctl</code> or <code>journalctl</code> can do by reading through their documentation:</p>
<pre><code>man systemctl
man journalctl
</code></pre>
<p>You can get the status, start, stop, reload, restart a servicer; e.g., sshd:</p>
<pre><code>systemctl status sshd.service
systemctl start sshd.service
systemctl stop sshd.service
systemctl reload sshd.service
systemctl restart sshd.service
systemctl reload-or-restart sshd.service
</code></pre>
<p>To enable, disable sshd (or some service):</p>
<pre><code>systemctl enable sshd.service
systemctl disable sshd.service
</code></pre>
<p>You can check if a service if enabled:</p>
<pre><code>systemctl is-enabled sshd.service
</code></pre>
<p>You can reboot, poweroff, or suspend a system:</p>
<pre><code>systemctl reboot
systemctl poweroff
systemctl suspend
</code></pre>
<p>To show configuration file changes to the system:</p>
<pre><code>systemd-delta
</code></pre>
<p>To list real-time control group process, resource usage, and memory usage:</p>
<pre><code>systemd-cgtop
</code></pre>
<ul>
<li>to search failed processes/services:</li>
</ul>
<pre><code>systemctl --state failed
</code></pre>
<ul>
<li>to list services</li>
</ul>
<pre><code>systemctl list-unit-files -t service
</code></pre>
<ul>
<li>to examine boot time:</li>
</ul>
<pre><code>systemd-analyze
</code></pre>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="./15-managing-users-groups.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="./17-backup-and-using-dnf.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./15-managing-users-groups.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./17-backup-and-using-dnf.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
