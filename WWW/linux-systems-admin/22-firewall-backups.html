<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Firewalls and Backups - Linux Systems Administration</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Book on entry level Linux systems administration work.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="p1-linux-sysadmin.html"><strong>1.</strong> Linux Systems Administration</a></li><li><ul class="section"><li><a href="01-history-linux-unix.html"><strong>1.1.</strong> History of Unix and Linux</a></li><li><a href="02-what-is-linux.html"><strong>1.2.</strong> What is Linux?</a></li><li><a href="03-what-is-sysadmin.html"><strong>1.3.</strong> What is Systems Administration?</a></li></ul></li><li><a href="p2-using-gcloud.html"><strong>2.</strong> Using Google Cloud (gcloud)</a></li><li><ul class="section"><li><a href="04-connect-with-ssh.html"><strong>2.1.</strong> Connect with Secure Shell</a></li><li><a href="05-using-gcloud-virtual-machines.html"><strong>2.2.</strong> Using gcloud for Virtual Machines</a></li></ul></li><li><a href="p3-the-command-line.html"><strong>3.</strong> Learning the Command Line</a></li><li><ul class="section"><li><a href="06-the-linux-filesystem.html"><strong>3.1.</strong> The Linux Filesystem</a></li><li><a href="07-files-and-directories.html"><strong>3.2.</strong> Files and Directories</a></li><li><a href="08-file-attributes.html"><strong>3.3.</strong> File Attributes</a></li><li><a href="09-text-processing-part-1.html"><strong>3.4.</strong> Text Processing: Part 1</a></li><li><a href="10-text-processing-part-2.html"><strong>3.5.</strong> Text Processing: Part 2</a></li><li><a href="11-text-editors.html"><strong>3.6.</strong> Text Editors</a></li><li><a href="12-revisiting-directory-paths.html"><strong>3.7.</strong> Revisiting Directory Paths</a></li><li><a href="13-bash-scripting.html"><strong>3.8.</strong> Bash Scripting</a></li><li><a href="14-regular-expressions.html"><strong>3.9.</strong> Regular Expressions</a></li></ul></li><li><a href="p4-managing-the-system.html"><strong>4.</strong> Managing the System</a></li><li><ul class="section"><li><a href="15-expanding-storage.html"><strong>4.1.</strong> Expanding Storage</a></li><li><a href="16-managing-users-groups.html"><strong>4.2.</strong> Managing Users and Groups</a></li><li><a href="17-managing-software.html"><strong>4.3.</strong> Managing Software</a></li><li><a href="18-using-systemd.html"><strong>4.4.</strong> Using systemd</a></li></ul></li><li><a href="p5-networking-security.html"><strong>5.</strong> Networking and Security</a></li><li><ul class="section"><li><a href="19-networking-tcpip.html"><strong>5.1.</strong> Networking and TCP/IP</a></li><li><a href="20-dns-domain-names.html"><strong>5.2.</strong> DNS and Domain Names</a></li><li><a href="21-local-security.html"><strong>5.3.</strong> Local Security</a></li><li><a href="22-firewall-backups.html" class="active"><strong>5.4.</strong> Firewalls and Backups</a></li></ul></li><li><a href="p6-creating-a-lamp-server.html"><strong>6.</strong> Creating a LAMP Server</a></li><li><ul class="section"><li><a href="23-installing-the-apache-web-server.html"><strong>6.1.</strong> Installing the Apache Web Server</a></li><li><a href="24-installing-configuring-php.html"><strong>6.2.</strong> Installing and Configuring PHP</a></li><li><a href="25-installing-configuring-mariadb.html"><strong>6.3.</strong> Installing and Configuring MariaDB</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="22-firewall-backups.html#firewalls-and-backups" id="firewalls-and-backups"><h1>Firewalls and Backups</h1></a>
<a class="header" href="22-firewall-backups.html#google-cloud-firewall-and-ubuntus-ufw" id="google-cloud-firewall-and-ubuntus-ufw"><h2>Google Cloud Firewall and Ubuntu's UFW</h2></a>
<p>A firewall program allows or denies connections for
incoming (<strong>ingress</strong>) or outgoing (<strong>egress</strong>) traffic.
Traffic can be controlled by link layer
(e.g., a network interface such as an ethernet or wireless card),
by IP layer
(e.g., IPv4 or IPv6 address or address ranges),
by transport layer
(e.g., TCP, UDP, etc.),
or by application layer via port numbers
(e.g., HTTP(S), SSH, SMTP, etc.).
Firewalls have other abilities.
For example, they can also place limits
on the number of attempts to connect.</p>
<blockquote>
<p>As a side note, physical, bare metal servers
may have multiple ethernet
network interface cards (NICs).
Each NIC would, of course, have its own MAC address,
and therefore would be assigned different IP addresses.
Thus, at the link layer, incoming connections can be
completely blocked on one card and then outgoing connections
can be completely blocked on the other.
This is a made up scenario.
In practice, whatever firewall rules in place would
be such that would make sense for the person or
organization creating them.</p>
</blockquote>
<p>To control these types of connections,
firewalls apply rules.
A rule may block all incoming connections, but
then allow SSH traffic through port 22,
either via TCP or UDP, and
then further restrict SSH connections to a
specific IP range.
And/or, another rule may block all incoming,
unencrypted HTTP connections through port 80, but
allow all incoming connections, encrypted HTTPS
connections through port 443.</p>
<p>Let's briefly cover two ways to define
firewall rules.
When we set up our LAMP servers in the
last part of this course,
we'll need to implement some rules to
allow outside connections to our server.</p>
<blockquote>
<p>LAMP originally referred to Linux, Apache, MySQL, and PHP;
these four technologies create a web server.
Technically, only Apache is needed.
PHP and MySQL provide additional functionality,
like the ability for a website to interact with a
relational database.
The <strong>M</strong> in LAMP may also refer to MariaDB,
which is fully open source clone of MySQL.
We'll use MariaDB later in this course.</p>
</blockquote>
<p>First, our Google Cloud instance is
<a href="https://cloud.google.com/vpc/docs/firewalls#more_rules_default_vpc">pre-populated with default firewall rules</a>
at the network level, and
the <a href="https://cloud.google.com/vpc/docs/firewalls">documentation</a>
provides an overview of these rules.
Second, Ubuntu uses a firewall
called <a href="https://help.ubuntu.com/community/UFW">ufw</a>, which
can be used to control additional connections
at the operating system level.
(Please read the documentation at those three links.)</p>
<p>It's important to know that these two firewalls provide
protection at different traffic stops, so to speak.
By that I mean,
a Google Cloud firewall rule may allow SSH (port 22)
traffic to a server instance, but
if Ubuntu's <code>ufw</code> firewall blocks port 22
connections at the server level,
then SSH traffic won't pass through.
In other words, incoming connections must pass
through the network firewall first, and then pass
through the server firewall second.
Outgoing connections must pass through
the server firewall first, and
then the network firewall second.</p>
<p>It's also important to know that Ubuntu's <code>ufw</code> firewall
is disabled by default.
In fact, it may be overkill to use both
Google Cloud's firewall and Ubuntu's <code>ufw</code>.</p>
<p>We'll return to firewalls and put some rules
into practice when we work on our LAMP setup.</p>
<a class="header" href="22-firewall-backups.html#backups" id="backups"><h2>Backups</h2></a>
<p>Catastrophes (natural, physical, criminal, or out of negligence) happen, and
as a systems administrator,
you may be required to have backup strategies
to mitigate data loss.</p>
<p>How you backup depends on the machine.
If I am managing physical hardware, for instance,
and I want to backup a physical disk to another physical disk,
then that requires a specific tool.
However, if I am managing virtual machines,
like our Google Cloud instance,
then that requires a different tool.
Therefore, in this section,
I will briefly cover both scenarios.</p>
<a class="header" href="22-firewall-backups.html#rsync" id="rsync"><h3>rsync</h3></a>
<p>If we were managing bare metal machines, then
we might use a program like <code>rsync</code> to backup
physical disk drives.
<code>rsync</code> is a powerful program.
It can copy disks, directories, and files.
It can copy files from one location,
and send the copies, encrypted, to a remote server.</p>
<p>For example, let's say I mount an external hard drive
to my filesystem at <strong>/mnt/backup</strong>.
To copy my home directory,
I'd use:</p>
<pre><code>rsync -av /home/me/ /mnt/backup/
</code></pre>
<p>Syntax matters here.
Specifically, if I include the trailing slash on
the source directory,
which is <strong>/home/me/</strong> in the above example,
then <code>rsync</code> will copy everything in <strong>/home/me/</strong>
to <strong>/mnt/backup/</strong>.
However, if I leave the trailing slash off,
like so:</p>
<pre><code>rsync -av /home/me /mnt/backup/
</code></pre>
<p>Then the result will be that the directory <strong>me/</strong>
will be copied to <strong>/mnt/backup/me/</strong>.</p>
<p>Let's see this in action.
Say I have two directories.
In the <strong>tmp1/</strong> directory,
there are two files: <strong>file1</strong> and <strong>file2</strong>.
The <strong>tmp2/</strong> directory is empty.
To copy <strong>file1</strong> and <strong>file2</strong> to <strong>tmp2</strong>, then:</p>
<pre><code>ls tmp1/
file1 file2
rsync -av tmp1/ tmp2/
ls tmp2
file1 file2
</code></pre>
<p>However, if I leave that trailing slash
off the source directory,
then the <strong>tmp1/</strong> will get copied to <strong>tmp2/</strong>:</p>
<pre><code>ls tmp1
file1 file2
rsync -av tmp1 tmp2/
ls tmp2/
tmp1/
ls tmp2/tmp1/
file1 file2
</code></pre>
<p><code>rsync</code> can also send a source directory
to a directory on a remote server, and
the directory and files being copied will
be encrypted on the way.
To do this, then we use <code>ssh</code> style syntax:</p>
<pre><code>rsync -av tmp1/ USER@REMOTE:~/tmp2/
</code></pre>
<p>In fact, not only do I use <code>rsync</code> to backup
my desktop computer to external hard drives,
I also use a command like the above to copy
local web projects to remote servers.</p>
<a class="header" href="22-firewall-backups.html#delete-option" id="delete-option"><h3>Delete Option</h3></a>
<p><code>rsync</code> has a
<code>--delete</code> option.
Adding this option means that <code>rsync</code> will
synchronize the source directory with the destination directory.
Thus if I had already created a backup
of <strong>tmp1</strong> to <strong>tmp2</strong>, and
then delete <strong>file1</strong> in <strong>tmp1</strong> later,
then run <code>rsync</code> with the delete option with the command below,
then <code>rsync</code> will also delete <strong>file1</strong> from <strong>tmp2/</strong>:</p>
<pre><code>ls tmp1/
file1 file2
rsync -av tmp1/ tmp2/
ls tmp2/
file1 file2
rm tmp1/file1
ls tmp1/
file2
rsync -av --delete tmp1/ tmp2/
ls tmp2
file2
</code></pre>
<p>Backups are no good if we don't know how to restore
a backup to a disk.
To restore with <code>rsync</code>, we just reverse the
destination directory with the source directory:</p>
<pre><code>rsync -av tmp2/ tmp1/
</code></pre>
<a class="header" href="22-firewall-backups.html#google-cloud" id="google-cloud"><h3>Google Cloud</h3></a>
<p>Since our instance on Google Cloud is a virtual machine,
we can use the Google Cloud console to create
<strong>snapshots</strong> of our instance.
A <strong>snapshot</strong> is a copy of a virtual machine at
the time the snapshot was taken.
What's great about taking a snapshot is that
the result is basically a file of a complete operating system.
Since it's a file,
it can itself be used in other projects or used
to restore a machine to the time the snapshot was taken.
Snapshots may also be used to document work.
For example, if I worked with programmers,
as a systems administrator,
I might help the programmer share snapshots of a virtual
machine with other programmers.
Those other programmers could then restore
the snapshot in their own instances
and see the original work.</p>
<p>Taking snapshots in Google Cloud is very straightforward, but
since it does take up extra storage,
it will accrue extra costs.
Since we can avoid that in practice,
please see the following documentation for how to take
a snapshot in Google Cloud:</p>
<p><a href="https://cloud.google.com/compute/docs/disks/create-snapshots">Create and manage disk snapshots</a></p>
<a class="header" href="22-firewall-backups.html#conclusion" id="conclusion"><h2>Conclusion</h2></a>
<p>In this section,
we covered firewalls and backups.
Since we're running an Ubuntu server on Google Cloud,
we have Google Cloud options
for creating firewall rules and for backing up disks, and
we have Ubuntu options for creating firewall rules and
for backing up disks.</p>
<p>How we go about either depends entirely on our needs
or on our organization's needs.
But knowing these options exit and
the different reasons why we have these options,
provides quite a bit of utility.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="21-local-security.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="p6-creating-a-lamp-server.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="21-local-security.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="p6-creating-a-lamp-server.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
