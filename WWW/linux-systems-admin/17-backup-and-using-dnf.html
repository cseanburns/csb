<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Backups and DNF - Linux Systems Administration</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Book on entry level Linux systems administration work.">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li><a href="./linux-sysadmin.html"><strong>1.</strong> Linux Systems Administration</a></li><li><a href="./p1-system-basics.html"><strong>2.</strong> System Basics</a></li><li><ul class="section"><li><a href="./01-history-linux-unix.html"><strong>2.1.</strong> History of Unix and Linux</a></li><li><a href="./02-quick-ssh-connect.html"><strong>2.2.</strong> Connect to a Remote Server</a></li><li><a href="./03-filesystem-file-management.html"><strong>2.3.</strong> Linux Filesystems and File Management</a></li><li><a href="./04-file-attributes.html"><strong>2.4.</strong> File Attributes</a></li><li><a href="./05-text-processing-part-1.html"><strong>2.5.</strong> Text Processing, Part 1</a></li><li><a href="./06-text-processing-part-2.html"><strong>2.6.</strong> Text Processing, Part 2</a></li><li><a href="./07-text-editors.html"><strong>2.7.</strong> Text Editors</a></li><li><a href="./08-revisiting-paths.html"><strong>2.8.</strong> Revisiting Paths</a></li><li><a href="./09-bash-scripting.html"><strong>2.9.</strong> Bash Scripting</a></li><li><a href="./10-regular-expressions.html"><strong>2.10.</strong> Regular Expressions</a></li></ul></li><li><a href="./p2-managing-services-software.html"><strong>3.</strong> Managing Services and Software</a></li><li><ul class="section"><li><a href="./11-using-gcloud.html"><strong>3.1.</strong> Using gcloud for Virtual Machines</a></li><li><a href="./12-expanding-storage.html"><strong>3.2.</strong> Expanding Storage</a></li><li><a href="./15-managing-users-groups.html"><strong>3.3.</strong> Managing Users and Groups</a></li><li><a href="./16-systemd.html"><strong>3.4.</strong> systemd</a></li><li><a href="./17-backup-and-using-dnf.html" class="active"><strong>3.5.</strong> Backups and DNF</a></li></ul></li><li><a href="./p3-networking-security.html"><strong>4.</strong> Networking and Security</a></li><li><ul class="section"><li><a href="./18-tcip-networking.html"><strong>4.1.</strong> TCIP Networking</a></li><li><a href="./19-networking-dns-domains.html"><strong>4.2.</strong> DNS and Domain Names</a></li><li><a href="./20-security-chroot.html"><strong>4.3.</strong> Security and chroot</a></li><li><a href="./21-security-firewall.html"><strong>4.4.</strong> Security and Firewalls</a></li></ul></li><li><a href="./p4-lamp.html"><strong>5.</strong> Creating a LAMP Server</a></li><li><ul class="section"><li><a href="./22-httpd-apache.html"><strong>5.1.</strong> Apache2 Web Server</a></li><li><a href="./23-httpd-php.html"><strong>5.2.</strong> Apache2 and PHP</a></li><li><a href="./24-httpd-virtualhosts.html"><strong>5.3.</strong> Apache2 and Virtual Hosts</a></li><li><a href="./25-httpd-mysql.html"><strong>5.4.</strong> Apache2 and MySQL</a></li></ul></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars" title="Toggle sidebar"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush" title="Change theme"></i>
                    </div>

                    <h1 class="menu-title">Linux Systems Administration</h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="./17-backup-and-using-dnf.html#backing-up-and-managing-software" id="backing-up-and-managing-software"><h1>Backing up and Managing Software</h1></a>
<a class="header" href="./17-backup-and-using-dnf.html#backup-with-rsync" id="backup-with-rsync"><h2>Backup with <code>rsync</code></h2></a>
<a class="header" href="./17-backup-and-using-dnf.html#using-our-backups-directory" id="using-our-backups-directory"><h3>Using our /backups directory</h3></a>
<p>To complete this assignment, you must have successfully completed <strong>Assignment 5: Logical Volumes</strong>.</p>
<p>In <strong>Assignment 5: Logical Volumes</strong>, we created an additional volume at <strong>/backups</strong>. In a real production scenario, we'd use separate drives and remote machines to store backups in order to full prepare for and recover from data loss. But for us, this <strong>/backups</strong> partition will work just fine.</p>
<a class="header" href="./17-backup-and-using-dnf.html#backup-with-rsync-1" id="backup-with-rsync-1"><h3>Backup with <code>rsync</code></h3></a>
<p>In the <strong>Managing Users and Groups</strong> forum, we created a new user for our system. This means that we have at least two user accounts to backup: ours and the new uers.</p>
<p>Now we'll use the <code>rsync</code> command to backup these users' home directories to the <strong>/backups</strong> volume/partition. See <code>man rsync</code> for documentation. The basic syntax is:</p>
<pre><code>rsync option source-directory destination-directory
</code></pre>
<p>Syntax matters here. Specifically, there are two ways to backup the home directories using <code>rsync</code> depending on a small detail in our commands. Consider the next two examples:</p>
<p>In this first example, the <code>rsync</code> command will back up the home directory and all subdirectories to the <code>/backups</code> directory. Thus, <code>rsync</code> behaves differently whether I include or leave out the trailing slash after the <strong>home</strong> source-directory.</p>
<p>Thus, if I run <code>rsync</code> this way:</p>
<pre><code>rsync -ahv --delete /home /backups/
</code></pre>
<p>The results will look like this:</p>
<pre><code>ls /backups
home
ls /backups/home
linus sean
</code></pre>
<p>If I include the trailing slash after the <strong>/home/</strong> directory, like so:</p>
<pre><code>rsync -ahv --delete /home/ /backups/
</code></pre>
<p>Then <code>rsync</code> will sync the contents of the <strong>/home/</strong> directory, and the results will include not <strong>/home</strong> but the specific directories contained in <strong>/home</strong>:</p>
<pre><code>ls /backups
linus sean
</code></pre>
<a class="header" href="./17-backup-and-using-dnf.html#delete-option" id="delete-option"><h3>Delete Option</h3></a>
<p>The <code>--delete</code> option is important. Without it, <code>rsync</code> will add new files to the destination directory when it backs up the source directory. With it, <code>rsync</code> truly syncs. Thus, if a file that was previously backed up to the destination directory and later deleted in the source directory (e.g., because it was no longer needed), then it will be deleted from the destination directory when the <code>--delete</code> option is used. This is how services like Dropbox work.</p>
<p>See other options and functionality for <code>rsync</code> here: <a href="https://www.linux.com/tutorials/how-backup-files-linux-rsync-command-line/">https://www.linux.com/tutorials/how-backup-files-linux-rsync-command-line/</a>. One of the most important options is the ability to backup up to remote machines over a network, and this can be done with the the <code>rsync</code> command.</p>
<a class="header" href="./17-backup-and-using-dnf.html#managing-software" id="managing-software"><h3>Managing Software</h3></a>
<p>Many modern Linux distros offer some kind of package management for installing, managing, and removing software. On RedHat based systems, package management is based on <code>rpm</code> (the RedHat Package Manager). On Debian based systems, package management is based on <code>dpkg</code>.</p>
<p>There are some advanced things you can do with these base package management systems (<code>rpm</code> or <code>dpkg</code>), but most of the time it will be easier to use their front ends. For RedHat systems, the current front end is called <code>dnf</code>, and for Debian systems, it's <code>apt</code> or <code>apt-get</code>. Since the Fedora distribution is part of the RedHat universe, we'll use the <code>dnf</code> command to manage software. As always, read the <code>man dnf</code> manual for more information. See also <a href="https://dnf.readthedocs.io/en/latest/command_ref.html">the online documentation on dnf</a>.</p>
<p>Let's look at a few of the basic <code>dnf</code> commands.</p>
<a class="header" href="./17-backup-and-using-dnf.html#dnf-info-and-search-commands" id="dnf-info-and-search-commands"><h3>dnf info and search commands</h3></a>
<p>To see a history of how <code>dnf</code> has been used on the system:</p>
<pre><code>dnf history
</code></pre>
<p>We get info on the history of a specific package on our system. Since we haven't installed anything yet, there's nothing to look at yet, but the basic syntax looks like this.</p>
<pre><code>dnf history package_name
</code></pre>
<p>To search for a package, we can use the following command to search for the <code>bash</code> package:</p>
<pre><code>dnf search bash
</code></pre>
<p>If the output is more than one page, we can <strong>pipe</strong> it through <code>less</code>.</p>
<p>To get technical information on a specific package, which we might want to do before we install it:</p>
<pre><code>dnf info bash
</code></pre>
<p>We can use <code>dnf</code> to search by tag in order to get information about a package. To get a list of possible tags to search by, we can use the following command:</p>
<pre><code>dnf reqoquery --querytags
</code></pre>
<p>Then to search by tag, we uset the following format that will show us tag-related information for the <code>bash</code> package:</p>
<pre><code>dnf repoquery --queryformat &quot;%{arch}&quot; bash
dnf repoquery --queryformat &quot;%{name}&quot; bash
dnf repoquery --queryformat &quot;%{release}&quot; bash
dnf repoquery --queryformat &quot;%{reponame}&quot; bash
</code></pre>
<p>Software managed by <code>dnf</code> is organized into groups, which contain multiple software packages. We can see a list of groups with this command:</p>
<pre><code>dnf group list
</code></pre>
<p>You should see a category called <strong>Installed Gruops</strong> and listed under that is <strong>Headless Management</strong>. You might recognize that from when we installed Fedora.</p>
<p>To see what packages would be installed with a group, such as the <strong>System Tools</strong> group, we can do:</p>
<pre><code>dnf group info &quot;System Tools&quot;
</code></pre>
<p>If we want to install the default packages with a group, then:</p>
<pre><code>sudo dnf group install &quot;System Tools&quot;
</code></pre>
<a class="header" href="./17-backup-and-using-dnf.html#dnf-install-process-and-commands" id="dnf-install-process-and-commands"><h3>dnf install process and commands</h3></a>
<p>It's pretty simple to install a software package. The hard part will involve configuring a package after it's installed, if it's a complicated piece of software. For now, let's install <code>tmux</code>, which is a terminal multiplexer that we can use to open and manage multiple terminals in a single window.</p>
<pre><code>dnf search tmux
dnf info tmux
sudo dnf install tmux
dnf history tmux
</code></pre>
<p>To use <code>tmux</code>, I like to use the <strong>ctrl-a</strong> keybinding to control it. By default it's set to use <strong>ctrl-b</strong>. Let's configure the new keybinding like so. Here we redirect the configuration to the configureation file in our home directory. Since I'm using a single redirect <strong>&gt;</strong>, this file gets created. Remember to use a double redirect <strong>&gt;&gt;</strong> if appending to the file.</p>
<pre><code>echo &quot;set-option -g prefix C-a&quot; &gt; $HOME/.tmux.conf
</code></pre>
<p>And then start <code>tmux</code> like so:</p>
<pre><code>tmux
</code></pre>
<p>When done, just type <code>exit</code>.</p>
<a class="header" href="./17-backup-and-using-dnf.html#updating-the-system" id="updating-the-system"><h4>Updating the system</h4></a>
<p>It's easy to update the entire system:</p>
<pre><code>sudo dnf update
sudo dnf clean all
</code></pre>
<p>The <code>dnf clean all</code> command removes the downloaded files, thereby freeing up storage space, used to update the system. It does not reverse the update.</p>
<a class="header" href="./17-backup-and-using-dnf.html#dnf-basics" id="dnf-basics"><h3>dnf basics</h3></a>
<p>Here are the basic <code>dnf</code> commands. See <code>man dnf</code> for details:</p>
<ul>
<li><code>dnf search [name]</code></li>
<li><code>dnf install [name]</code></li>
<li><code>dnf remove [name]</code></li>
<li><code>dnf repolist</code></li>
<li><code>dnf list installed</code></li>
<li><code>dnf list available</code></li>
<li><code>dnf provides /usr/bin/bash</code></li>
<li><code>dnf info [name]</code></li>
<li><code>dnf update [name]</code></li>
<li><code>dnf check-update</code></li>
<li><code>dnf update OR dnf upgrade</code></li>
<li><code>dnf autoremove</code></li>
<li><code>dnf clean all</code></li>
<li><code>dnf help clean</code></li>
<li><code>dnf help</code></li>
<li><code>dnf history</code></li>
<li><code>dnf group list 'Python Science'</code></li>
<li><code>dnf group info 'Python Science'</code></li>
<li><code>dnf group install 'Python Science'</code></li>
<li><code>dnf group install --with -optional 'Python Science'</code></li>
<li><code>dnf group upgrade 'Python Science'</code></li>
<li><code>dnf group remove 'Python Science'</code></li>
</ul>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="./16-systemd.html" class="mobile-nav-chapters previous" title="Previous chapter">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="./p3-networking-security.html" class="mobile-nav-chapters next" title="Next chapter">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="./16-systemd.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="./p3-networking-security.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
