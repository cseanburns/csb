<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Notmuch cheat sheet to remember basic commands and operations">
    <title>Notmuch Cheat Sheet</title>
    <base href="https://cseanburns.net/">
    <link rel="stylesheet" href="WWW/style.css">
    <link rel="icon" type="image/png" sizes="16x16" href="images/f16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/f32.png">
    <link rel="icon" type="image/png" sizes="72x72" href="images/f72.png">
    <link rel="icon" type="image/png" sizes="114x114" href="images/f114.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/f144.png">
<style>
body {
	max-width: 120ch;
}

table, th, td {
	text-align: left;
}
</style>
  </head>

  <body>
    <header>
      <nav>
          <p>
          <a href="index.html">Home</a> &rarr;
          <a href="NOTES/index.html">NOTES</a> &rarr;
          <a href="NOTES/TECH/index.html">TECH</a> &rarr; Notmuch Cheat Sheet
          </p>
      </nav>
    </header>

<main>
	<h1 id="notmuch-cheatsheet">Notmuch Cheatsheet</h1>

	<p>I've used <a href="https://notmuchmail.org/">notmuch</a> with the <a href="http://www.mutt.org/">mutt</a> email client for years, but
	mostly as a tool to search my email.
	I organize my email by folders or directories, and archive based on year (e.g., year2020, etc).
	In the last few years, though, I've begun to accumulate email folders that I used to manage various projects, and recently,
	I've felt like these folders are muddying my system up.
	To fix this, I finally started to explore <code>notmuch</code> tags, and now I'm a fan.
	I assembled this cheat sheet to help me remember some of the more common commands.</p>


	<h2 id="notmuch-commands">Notmuch commands</h2>

	<p>We generally run these commands on the command line.</p>

	<table>
		<thead>
			<tr class="header">
				<th>Purpose</th>
				<th>Command</th>
				<th>What it does</th>
				<th>When to use it</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td>index new mail</td>
				<td><code>notmuch new</code></td>
				<td>scans maildir and updates database</td>
				<td>after syncing or moving mail</td>
			</tr>
			<tr class="even">
				<td>search messages</td>
				<td><code>notmuch search &lt;query&gt;</code></td>
				<td>lists matching threads / queries</td>
				<td>quick cli search</td>
			</tr>
			<tr class="odd">
				<td>count matches</td>
				<td><code>notmuch count &lt;query&gt;</code></td>
				<td>returns number of matching messages</td>
				<td>checking tag counts</td>
			</tr>
			<tr class="even">
				<td>show full message</td>
				<td><code>notmuch show &lt;query&gt;</code></td>
				<td>displays complete thread content</td>
				<td>inspect mail outside mutt</td>
			</tr>
			<tr class="odd">
				<td>lists tags in use</td>
				<td><code>notmuch search --output=tags '*'</code></td>
				<td>lists all tags currently in DB</td>
				<td>audit my tagging</td>
			</tr>
			<tr class="even">
				<td>add a tag</td>
				<td><code>notmuch tag +foo -- &lt;query&gt;</code></td>
				<td>adds tag <code>foo</code> to matching email</td>
				<td>bulk labeling</td>
			</tr>
			<tr class="odd">
				<td>remove a tag</td>
				<td><code>notmuch tag -foo -- &lt;query&gt;</code></td>
				<td>removes tag <code>foo</code> to matching email</td>
				<td>cleanup</td>
			</tr>
			<tr class="even">
				<td>replace a tag</td>
				<td><code>notmuch tag +newtag -oldtag -- &lt;query&gt;</code></td>
				<td>swaps tag states</td>
				<td>relabel emails</td>
			</tr>
			<tr class="odd">
				<td>search by folder</td>
				<td><code>notmuch search path:folder/**</code></td>
				<td>query by maildir path</td>
				<td>when using folders and tags</td>
			</tr>
			<tr class="even">
				<td>output filenames</td>
				<td><code>notmuch search --output=files &lt;query&gt;</code></td>
				<td>list raw file paths</td>
				<td>for scripting or moving emails</td>
			</tr>
			<tr class="odd">
				<td>dump DB</td>
				<td><code>notmuch dump &gt; backup.txt</code></td>
				<td>export all tags</td>
				<td>before major changes</td>
			</tr>
				<tr class="even">
				<td>restore DB</td>
				<td><code>notmuch restore &lt; backup.txt</code></td>
				<td>restores tags</td>
				<td>recovery / migration</td>
			</tr>
			<tr class="odd">
				<td>compact DB</td>
				<td><code>notmuch compact</code></td>
				<td>restores tags</td>
				<td>recovery / migration</td>
			</tr>
			<tr class="even">
				<td>rebuild from scratch (XDG)</td>
				<td><code>rm -r ~/.local/share/notmuch/ &amp;&amp; notmuch new</code></td>
				<td>full reindex</td>
				<td>in case of DB corruption</td>
			</tr>
			<tr class="odd">
				<td>rebuild from scratch (ex. older PATH)</td>
				<td><code>rm -r ~/Mail/.notmuch/ &amp;&amp; notmuch new</code></td>
				<td>full reindex</td>
				<td>in case of DB corruption</td>
			</tr>
		</tbody>
	</table>
	<p>I don't run all the commands above on the command line.
	For example, I update the Notmuch DB within Mutt when I sync my email.
	Here's an example from my <code>.muttrc</code> file:</p>

	<pre><code>
# RETRIEVING EMAIL
macro index,pager <F4> "<shell-escape>clear ; /usr/bin/mbsync -a ; notmuch new" "Retrieve new email"
	</code></pre>

	<h2 id="useful-search-patterns">Useful search patterns</h2>

	<p>I generally run searches like those listed in the table below from within the Mutt email client.
	Search is bound to the F8 key.
	Here's the macro for that, which I likely got from the Notmuch website a long time ago:</p>

	<pre><code>
# SEARCH EMAIL
macro index <F8> \
"<enter-command>set my_old_pipe_decode=\$pipe_decode my_old_wait_key=\$wait_key nopipe_decode nowait_key<enter>\
<shell-escape>notmuch-mutt -r --prompt search<enter>\
<change-folder-readonly>`echo ${XDG_CACHE_HOME:-$HOME/.cache}/notmuch/mutt/results`<enter>\
<enter-command>set pipe_decode=\$my_old_pipe_decode wait_key=\$my_old_wait_key<enter>" \
"notmuch: search mail"
	</code></pre>

	<table>
		<thead>
			<tr class="header">
				<th>Query</th>
				<th>Meaning</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td><code>tag:inbox</code></td>
				<td>needs processing</td>
			</tr>
			<tr class="even">
				<td><code>tag:unread</code></td>
				<td>not yet read</td>
			</tr>
			<tr class="odd">
				<td><code>from:alice</code></td>
				<td>mail from alice</td>
			</tr>
			<tr class="even">
				<td><code>subject:&quot;budget review&quot;</code></td>
				<td>exact phrase in subject</td>
			</tr>
			<tr class="odd">
				<td><code>date:30d..now</code></td>
				<td>last 30 days</td>
			</tr>
			<tr class="even">
				<td><code>path:year2019/**</code></td>
				<td>mail in that folder</td>
			</tr>
			<tr class="odd">
				<td><code>tag:waiting and date:14d..now</code></td>
				<td>recent mail w/ labeled as ‘waiting’</td>
			</tr>
			<tr class="even">
				<td><code>from:aol.com</code></td>
				<td>domain based senders</td>
			</tr>
			<tr class="odd">
				<td><code>thread:&lt;message-id&gt;</code></td>
				<td>entire conversation</td>
			</tr>
		</tbody>
	</table>
</main>

<hr>

<footer>
	<p>This site is my own work.
	The writing, ideas, and projects here are independent of any institution or affiliation.</p>

	<p>Copyright by C. Sean Burns, 2019.
	Last modified: <time datetime="2026-02-12">2026-02-12</time>.</p>
</footer>

  </body>
</html>
